Tháº¥y trÃªn giang há»“ dáº¡o nÃ y xuáº¥t hiá»‡n khÃ¡ nhiá»u yÃªu cáº§u vá» tool há»— trá»£ pick tÆ°á»›ng nhanh, nÃªn táº¡i háº¡ Ä‘Ã¢y cÅ©ng bá» tÃ­ thá»i gian ra Ä‘á»ƒ nghiÃªn cá»©u. Tuy khÃ´ng pháº£i lÃ  má»™t game thá»§ **LiÃªn Minh Huyá»n Thoáº¡i**, nhÆ°ng táº¡i háº¡ cÅ©ng Ä‘Ã£ tá»«ng chÆ¡i qua nÃ³. Sau khi hoÃ n táº¥t bÃ i viáº¿t nÃ y, táº¡i háº¡ láº¡i cÃ ng thÃ­ch nÃ³ hÆ¡n, khÃ´ng pháº£i lÃ  game hay, mÃ  lÃ  cÃ´ng nghá»‡ táº¡o ra nÃ³.

<p align='center'>
<img src='https://i.ytimg.com/vi/GHnoNzH3g2M/maxresdefault.jpg' height='280px'>
</p>

BÃ i toÃ¡n cá»§a chÃºng ta khÃ´ng Ä‘Æ¡n thuáº§n nhÆ° tiÃªu Ä‘á», mÃ  lÃ : **tá»± Ä‘á»™ng cháº¥p nháº­n tráº­n Ä‘áº¥u vÃ  pick-lock tÆ°á»›ng siÃªu nhanh chá»‰ báº±ng trÃ¬nh duyá»‡t web**! TrÃªn thá»±c táº¿, bÃ i viáº¿t nÃ y nháº±m má»¥c Ä‘Ã­ch giÃºp cÃ¡c vá»‹ tÃ¬m hiá»ƒu vá» League Client vÃ  cÃ¡ch sá»­ dá»¥ng API.

NhÃ¬n scrollbar Ä‘i, náº¿u cÃ¡c vá»‹ Ä‘Ã¢y khÃ´ng muá»‘n dÃ i dÃ²ng hay tháº­m chÃ­ lÃ  chá»‰ muá»‘n Ä‘áº¡t Ä‘Æ°á»£c nhÆ° tiÃªu Ä‘á» thÃ¬ cÃ³ thá»ƒ nháº£y tháº³ng Ä‘áº¿n pháº§n [**THá»°C HIá»†N**](#thá»±c-hiá»‡n) ngay vÃ  luÃ´n nhÃ©.

## NGÃ‚M Cá»¨U
Trong quyá»ƒn **Binh PhÃ¡p** cá»§a **TÃ´n Tá»­** cÃ³ cÃ¢u:
<p align='center'>
<img src='https://www.elleman.vn/wp-content/uploads/2019/08/06/binhphaptontu-ELLEMan-Feature.jpg' height='300px'>
<br>
<em>"Biáº¿t ngÆ°á»i biáº¿t ta, trÄƒm tráº­n trÄƒm tháº¯ng"</em>
</p>

ÄÃºng váº­y, muá»‘n lÃ m Ä‘Æ°á»£c thÃ¬ pháº£i hiá»ƒu rÃµ vá» **League Client**, má»™t khi Ä‘Ã£ thÃ´ng Ä‘Æ°á»£c nÃ³ thÃ¬ má»i chuyá»‡n dá»… nhÆ° trá»Ÿ bÃ n tay ğŸ˜†

### League Client truyá»‡n

Khoáº£ng giá»¯a nÄƒm 2016 thÃ¬ **Riot** báº¯t Ä‘áº§u tung ra báº£n alpha cá»§a client má»›i, mang Ä‘áº¿n má»™t giao diá»‡n hoÃ n toÃ n má»›i Ä‘Æ°á»£c gá»i lÃ  **Hextech UI**. Tá»« Hextech Ä‘Ã£ xuáº¥t hiá»‡n trÆ°á»›c Ä‘Ã³ khÃ¡ lÃ¢u, trong má»™t sá»‘ skin, bÃ¡u váº­t vÃ  cáº£ cá»‘t truyá»‡n game... vÃ  gáº§n nhÆ° lÃ  Ä‘á»™c quyá»n cá»§a **Riot**.

ÄÃ¢y lÃ  2 bÃ i viáº¿t mÃ  Riot cá»‘ tÃ¬nh tiáº¿t lá»™ vá» cÃ¡c cÃ´ng nghá»‡ Ä‘Æ°á»£c sá»­ dá»¥ng trong client má»›i:
- [The Architecture of the League Client Update](https://technology.riotgames.com/news/architecture-league-client-update)
- [Under the hood of the League Clientâ€™s Hextech UI](https://technology.riotgames.com/news/under-hood-league-client%E2%80%99s-hextech-ui)

Client má»›i Ä‘Æ°á»£c gá»i lÃ  **LCU** (tá»©c League Client Update, thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng trong giá»›i dev). Váº­y cháº¯c cÅ©ng cÃ³ tá»« **LCO** nhá»‰? KhÃ´ng Ä‘Ã¢u, nhÆ°ng mÃ¬nh sáº½ dÃ¹ng tá»« nÃ y trong bÃ i viáº¿t Ä‘á»ƒ chá»‰ **client cÅ©**.

Äi ngÆ°á»£c vá» quÃ¡ khá»©, khoáº£ng hÆ¡n mÆ°á»i nÄƒm vá» trÆ°á»›c - lÃºc mÃ  Riot váº«n cÃ²n Ä‘ang phÃ¡t triá»ƒn LMHT. 

Báº¥y giá», **LCO** Ä‘Æ°á»£c viáº¿t báº±ng **C++**, cÃ²n UI sá»­ dá»¥ng ná»n táº£ng [**Adobe AIR**](https://en.wikipedia.org/wiki/Adobe_AIR) (Ä‘Æ°á»£c phÃ¡t triá»ƒn tá»« **Flash**). Vá» káº¿t ná»‘i vÃ  truyá»n táº£i dá»¯ liá»‡u giá»¯a client, game vÃ  tÆ°Æ¡ng tÃ¡c vá»›i API core, Riot sá»­ dá»¥ng giao thá»©c [**RTMP**](https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol). AIR nhÆ° lÃ  má»™t há»‡ khÃ©p kÃ­n, vÃ  RTMP lÃ  cá»•ng chÃ­nh Ä‘á»ƒ truyá»n táº£i dá»¯ liá»‡u, giao tiáº¿p vá»›i bÃªn ngoÃ i.

Sau Ä‘áº¥y Riot nháº­n tháº¥y ráº±ng **AIR** Ä‘Ã£ dáº§n lá»—i thá»i vÃ  **LCO** hiá»‡n táº¡i Ä‘Ã£ khÃ¡ cÅ©. Trong lÃºc ná»n táº£ng web Ä‘ang lÃ m mÆ°a lÃ m giÃ³, khÃ´ng cáº§m lÃ²ng trÆ°á»›c cÃ¡c trang web mÃ u mÃ¨ cÃ¹ng hiá»‡u á»©ng chuyá»ƒn Ä‘á»™ng lung linh, tháº¿ lÃ  há» quyáº¿t Ä‘á»‹nh xÃ¢y dá»±ng má»™t diá»‡n máº¡o má»›i cho client báº±ng **HTML** vÃ  **JavaScript** (sau khi **HTML5** xuáº¥t hiá»‡n 1 nÄƒm).

<p align="center">
    <img src="https://technology.riotgames.com/sites/default/files/lcu_htmljs_in.png" height="300px"/>
</p>

LÃºc Ä‘Ã³, **JavaScript** nhÆ° lÃ  má»™t Ã´ng trÃ¹m vÃ  Ä‘á»©ng sau lÃ  **node.js**. NhÆ°ng Riot khÃ´ng muá»‘n phá»¥ thuá»™c vÃ o **node.js** mÃ  lÃ  xÃ¢y dá»±ng ná»n táº£ng riÃªng tÆ°Æ¡ng tá»±, tháº¿ lÃ  há» Ä‘Æ°a ra lá»±a chá»n dá»‹ theo concept cÅ©: váº«n sá»­ dá»¥ng **RTMP** kÃ¨m bá»™ xá»­ lÃ½ responses báº¥t Ä‘á»“ng bá»™, thay vÃ o Ä‘Ã³ lÃ  xÃ¢y dá»±ng UI báº±ng **CEF**.

<p align="center">
    <img src="https://technology.riotgames.com/sites/default/files/lcu_architecture_1.png" height="300px"/>
</p>

[**CEF**](https://en.wikipedia.org/wiki/Chromium_Embedded_Framework) lÃ  viáº¿t táº¯t cá»§a **Chromium Embedded Framework**, má»™t C++ framework há»— trá»£ nhÃºng bá»™ vi xá»­ lÃ½ cá»§a trÃ¬nh duyá»‡t **Chromium** vÃ o á»©ng dá»¥ng desktop. Project nÃ y Ä‘Æ°á»£c viáº¿t tá»« source cá»§a nhÃ¢n Chromium vÃ  gáº§n nhÆ° táº­n dá»¥ng má»i thá»© tá»« nÃ³.

> Riot chÃª node.js cháº­m vÃ  khÃ´ng muá»‘n viáº¿t má»i thá»© báº±ng JavaScript.

#### Microservices

ÄÃ¢y lÃ  nÆ¡i chá»©a cÃ¡c tÃ i nguyÃªn cá»§a client, vÃ  lÃ  nÆ¡i pháº£n há»“i cÃ¡c request tá»« UI. RTMP sáº½ Ä‘áº£m nhiá»‡m lÃ m cá»•ng trung gian truyá»n táº£i dá»¯ liá»‡u.

<p align="center">
    <img src="https://technology.riotgames.com/sites/default/files/lcu_architecture_2.png" height="300px"/>
</p>

Cháº³ng háº¡n, khi báº¡n click vÃ o xem tÆ°á»›ng (Bá»™ sÆ°u táº­p > TÆ°á»›ng), UI sáº½ gá»­i má»™t request Ä‘áº¿n **microservices**. Trong lÃºc chá» pháº£n há»“i, UI sáº½ hiá»ƒn thá»‹ má»™t loader thay tháº¿. Náº¿u respone thÃ nh cÃ´ng, server tráº£ vá» dá»¯ liá»‡u dáº¡ng JSON chá»©a thÃ´ng tin tÆ°á»›ng Ä‘Ã£ sá»Ÿ há»¯u, tÆ°á»›ng miá»…n phÃ­, giÃ¡ cáº£... vÃ  UI chá»‰ cáº§n xá»­ lÃ½ liá»‡u Ä‘Ã³ Ä‘á»ƒ káº¿t xuáº¥t thÃ nh giao diá»‡n rá»“i hiá»ƒn thá»‹ cho báº¡n xem.

ÄÆ°á»£c biáº¿t, **CEF** cÃ³ há»— trá»£ API cá»§a **V8 core** (Javascript engine) Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c hai chiá»u vá»›i **DOM** trong UI báº±ng **C++**. Náº¿u nhÆ° há» sá»­ dá»¥ng trá»±c tiáº¿p theo phÆ°Æ¡ng phÃ¡p nÃ y thÃ¬ cÃ³ thá»ƒ sáº½ nhanh hÆ¡n Ä‘Æ°á»£c pháº§n nÃ o, vá»«a khÃ©p kÃ­n, vá»«a an toÃ n. CÃ³ láº½ do pháº£i giá»¯ concept cÅ© Ä‘á»ƒ káº¿t ná»‘i má»™t máº¡ch vá»›i game core.

#### Swagger docs

Trong bÃ i giá»›i thiá»‡u vá» kiáº¿n trÃºc **LCU**, há» cÃ³ tiáº¿t lá»™ vá» xÃ¢y dá»±ng tÃ i liá»‡u cho API báº±ng Swagger UI.
<p align='center'>
<img src='https://technology.riotgames.com/sites/default/files/lcu_swagger.jpg' height='400px'>
</p>

> Äiá»u nÃ y giÃºp ta dá»… dÃ ng sá»­ dá»¥ng API hÆ¡n, cho dÃ¹ lÃ  end-users.

### TÃ¬m cá»•ng káº¿t ná»‘i Ä‘áº¿n LCU

RTMP mÃ  Riot sá»­ dá»¥ng lÃ  RTMPT (Tunneled - Ä‘Æ°á»ng háº§m), cÃ¡c gÃ³i tin Ä‘Æ°á»£c trao Ä‘á»•i thÃ´ng qua HTTP. Khoáº£ng 2018 thÃ¬ Riot báº¯t Ä‘áº§u cáº­p nháº­t báº£o máº­t cho RTMP, thÃªm **TSL**/**SSL** vÃ  sá»­ dá»¥ng **HTTPS** cho cá»•ng káº¿t ná»‘i.

> Váº­y ta chá»‰ cáº§n biáº¿t Ä‘Æ°á»£c cá»•ng káº¿t ná»‘i vÃ  phÆ°Æ¡ng thá»©c xÃ¡c thá»±c lÃ  cÃ³ thá»ƒ truy cáº­p vÃ o há»‡ thá»‘ng.

Äáº§u tiÃªn, báº¡n hÃ£y má»Ÿ **League Client** lÃªn, vÃ  Ä‘á»ƒ Ä‘Ã³.

Tiáº¿p theo lÃ  truy cáº­p vÃ o thÆ° má»¥c chá»©a **LCU**, trÃªn **Windows** cÃ³ thá»ƒ click pháº£i vÃ o process **LeagueClient.exe** vÃ  chá»n "Open file location" (trong Task Manager).
```js
> máº«u Ä‘Æ°á»ng dáº«n
..?/..?/LeagueClient/               ; Garena
..?/Riot Games/League of Legends/   ; Riot
```

Táº¡i Ä‘Ã¢y, báº¡n sáº½ tháº¥y cÃ³ má»™t file tÃªn lÃ  **lockfile**, má»Ÿ nÃ³ sáº½ tháº¥y ná»™i dung cÃ³ dáº¡ng nhÆ° sau:
```
> lockfile
LeagueClient:01234:56789:abcdef123456ABCDEF123456:https
```
- Xem dáº¥u hai cháº¥m nhÆ° lÃ  Ä‘iá»ƒm ngÄƒn cÃ¡ch, ta sáº½ Ä‘Æ°á»£c 5 pháº§n (tá»« trÃ¡i qua).
- Pháº§n thá»© ba chÃ­nh lÃ  **port** (cá»•ng cá»§a káº¿t ná»‘i).
- Pháº§n thá»© tÆ° lÃ  remoting auth, mÃ¬nh sáº½ gá»i lÃ  **pass** (máº­t kháº©u xÃ¡c thá»±c).
- Vá» giao thá»©c káº¿t ná»‘i thÃ¬ máº·c Ä‘á»‹nh lÃ  **HTTPS** luÃ´n.

#### Náº¿u viá»‡c tÃ¬m thÆ° má»¥c quÃ¡ ráº¯c rá»‘i Ä‘á»‘i vá»›i báº¡n, hÃ£y thá»­ dÃ¹ng lá»‡nh.
TrÃªn **Windows**, má»Ÿ **cmd** dÆ°á»›i quyá»n admin vÃ  nháº­p:
```bash
WMIC PROCESS WHERE name='LeagueClientUx.exe' GET commandline
```
CÃ²n Ä‘á»‘i vá»›i **OSX** thÃ¬ nháº­p vÃ o terminal:
```bash
ps x -o args | grep 'LeagueClientUx'
```

Káº¿t quáº£ nháº­n Ä‘Æ°á»£c sáº½ lÃ  cÃ¡c tham sá»‘ truyá»n vÃ o khi **LeagueClientUx** Ä‘Æ°á»£c thá»±c thi, Ä‘oáº¡n sau chÃ­nh lÃ  pass vÃ  port cáº§n tÃ¬m:
```
"--remoting-auth-token=abcdef123456ABCDEF123456" "--app-port=56789"
```
Táº¡i sao cÃ³ thá»ƒ dÃ¹ng cÃ¡ch nÃ y?
> Ã€, LeagueClientUx lÃ  tá»‡p thá»±c thi Ä‘á»™c láº­p, khÃ´ng cÃ³ cÃ¡ch nÃ o khÃ¡c Ä‘á»ƒ truyá»n **dá»¯ liá»‡u Ä‘á»™ng** vÃ o nÃ³ ngoÃ i viá»‡c truyá»n qua tham sá»‘ khi thá»±c thi.

> Process **LeagueClient** lÃ  pháº§n chÃ­nh cá»§a client (chá»‰ cháº¡y ná»n), nÃ³ sinh ra auth; cÃ²n **LeagueClientUx** má»›i lÃ  giao diá»‡n, tháº±ng nÃ y náº¡p auth thÃ´ng qua tham sá»‘ Ä‘á»ƒ xÃ¡c thá»±c.

Váº­y theo vÃ­ dá»¥ trÃªn, ta cÃ³ Ä‘Æ°á»ng dáº«n sau: `https://127.0.0.1:56789`

> NÃªn nhá»›, má»—i láº§n má»Ÿ League Client thÃ¬ pass vÃ  port sáº½ thay Ä‘á»•i.

### TrÃ¬nh duyá»‡t web Ä‘á»ƒ lÃ m gÃ¬?

Cháº¯c ai cÅ©ng tháº¯c máº¯c vá» trÃ¬nh duyá»‡t web trong pháº§n Ä‘áº§u cá»§a bÃ i viáº¿t nhá»‰. Táº­n dá»¥ng Ä‘Æ°á»£c lÃ  quáº¥t thoy ğŸ˜
- NhÃ  nhÃ  Ä‘á»u cÃ³ nÃ³, má»i ngÆ°á»i Ä‘á»u cÃ³ thá»ƒ lÃ m Ä‘Æ°á»£c.
- TrÃ¬nh duyá»‡t há»— trá»£ console built-in khÃ¡ máº¡nh, cÃ³ thá»ƒ gá»­i request dá»… dÃ ng nÃªn khÃ´ng cáº§n sá»­ dá»¥ng cÃ´ng cá»¥ nÃ o khÃ¡c.

Trong bÃ i nÃ y mÃ¬nh khuyÃªn nÃªn sá»­ dá»¥ng  trÃ¬nh duyá»‡t nhÃ¢n **Chromium** hoáº·c **FireFox** cÃ³ há»— trá»£ **ES6**.

### TÃ¬m API

Táº¡i Ä‘Ã¢y cÃ³ 2 lá»±a chá»n cho báº¡n, nhÆ°ng mÃ¬nh khuyáº¿n khÃ­ch nÃªn dÃ¹ng cÃ¡ch thá»© hai.

#### CÃ¡ch 1 - dÃ¹ng Ä‘á»“ lÃ m sáºµn
[Rift Explorer](https://github.com/Pupix/rift-explorer) lÃ  má»™t cÃ´ng cá»¥ dá»±a trÃªn **nodejs** + **electronjs**, giÃºp khÃ¡m phÃ¡ **LCU API**, Ä‘á»‘i vá»›i mÃ¡y chá»§ cá»§a **Garena** thÃ¬ khÃ´ng hiá»‡u nghá»‡m Ä‘Ã¢u. 

NgoÃ i ra, báº¡n cÃ³ thá»ƒ truy cáº­p trang [lcu.vivide.re](http://lcu.vivide.re/) Ä‘á»ƒ xem **API** Ä‘Æ°á»£c trÃ­ch xuáº¥t sáºµn (tuy lÃ  tá»« **v8.24** nhÆ°ng váº«n cÃ²n dÃ¹ng Ä‘Æ°á»£c).

#### CÃ¡ch 2 - tá»‘n cÆ¡m nhÆ°ng hiá»‡u quáº£
Táº¯t client Ä‘ang cháº¡y, truy cáº­p thÆ° má»¥c chá»©a **LCU**, má»Ÿ file cÃ³ tÃªn **system.yaml** vÃ  thÃªm dÃ²ng sau:
```yaml
> system.yaml
< thÃªm dÃ²ng nÃ y vÃ o cuá»‘i file
[        voice_url: https://...
enable_swagger: true
```
> Chá»— nÃ y thá»±c sá»± khÃ³ hiá»ƒu, Ä‘áº¿n táº­n tay game thá»§ mÃ  váº«n giá»¯ option Ä‘Ã³ ğŸ¤£

Khá»Ÿi Ä‘á»™ng League Client lÃªn. Sau Ä‘Ã³ lÃ  khá»Ÿi Ä‘á»™ng trÃ¬nh duyá»‡t trong cháº¿ Ä‘á»™ **insecure** (khÃ´ng an toÃ n), Ä‘á»‘i vá»›i trÃ¬nh duyá»‡t nhÃ¢n **Chromium** cÃ³ thá»ƒ cháº¡y vá»›i cÃ¡c flag (cá») sau:
```bash
> terminal
< TrÃªn {Windows} thÃ¬ dÃ¹ng {cmd} dÆ°á»›i quyá»n admin.
chrome --ignore-certificate-errors --disable-web-security --user-data-dir="./"
```
- Má»¥c Ä‘Ã­ch cá»§a viá»‡c nÃ y lÃ  trÃ¡nh bá»‹ dÃ­nh [Cross-Origin Read Blocking](https://stackoverflow.com/questions/50873764/cross-origin-read-blocking-corb) khi request vÃ o trang _khÃ´ng chÃ­nh chá»§_.
- Pháº£i táº¯t háº¿t cÃ¡c tab cá»§a trÃ¬nh duyá»‡t trÆ°á»›c, náº¿u Ä‘iá»u nÃ y lÃ m phiá»n báº¡n thÃ¬ cÃ³ thá»ƒ táº£i báº£n build sáºµn cá»§a trÃ¬nh duyá»‡t Chromium [táº¡i Ä‘Ã¢y](https://download-chromium.appspot.com/).

Tiáº¿p tá»¥c truy cáº­p vÃ o trang [petstore.swagger.io](https://petstore.swagger.io/) Ä‘á»ƒ sá»­ dá»¥ng **Swagger UI** (live demo). ÄÃ¢y lÃ  v3 nÃªn khÃ¡ lÃ  lag, báº¡n cÃ³ thá»ƒ táº£i source v2 [táº¡i Ä‘Ã¢y](https://github.com/swagger-api/swagger-ui/releases/tag/v2.2.8), sau khi giáº£i nÃ©n sáº½ tháº¥y bÃªn trong cÃ³ thÆ° má»¥c **dist**, kÃ©o file **index.html** bÃªn trong rá»“i tháº£ vÃ o trÃ¬nh duyá»‡t.

Trong **Swagger UI**, báº¡n nháº­p Ä‘Æ°á»ng dáº«n sau vÃ  nháº¥n nÃºt **Explore**:
```
https://127.0.0.1:PORT/swagger/v2/swagger.json
```
- Chá»— PORT thay báº±ng port cá»§a báº¡n.

Sau Ä‘áº¥y sáº½ cÃ³ má»™t há»™p thoáº¡i Ä‘Äƒng nháº­p hiá»‡n ra, pháº§n tÃªn ngÆ°á»i dÃ¹ng Ä‘á»ƒ lÃ  **riot**, cÃ²n máº­t kháº©u thÃ¬ nháº­p pass lÃºc nÃ£y. Chá» má»™t tÃ­ cho nÃ³ táº£i xong rá»“i táº­n hÆ°á»Ÿng!

### XÃ¢y dá»±ng thuáº­t toÃ¡n

TÃ¬m mÃ£i trong cÃ¡c **API**, cuá»‘i cÃ¹ng thÃ¬ mÃ¬nh cÅ©ng chá»n ra Ä‘Æ°á»£c 6 tháº±ng nÃ y:
```
1. GET   /lol-champions/v1/owned-champions-minimal
2. GET   /lol-matchmaking/v1/ready-check
3. POST  /lol-matchmaking/v1/ready-check/accept
4. GET   /lol-champ-select/v1/session
5. PATCH /lol-champ-select/v1/session/actions/{id}
6. POST  /lol-champ-select/v1/session/actions/{id}/complete
```
**#1** Ä‘á»ƒ xem táº¥t cáº£ cÃ¡c tÆ°á»›ng cÃ³ thá»ƒ chÆ¡i Ä‘Æ°á»£c (bao gá»“m tÆ°á»›ng Ä‘Ã£ sá»Ÿ há»¯u vÃ  miá»…n phÃ­). CÃ²n **#2** dÃ¹ng Ä‘á»ƒ kiá»ƒm tra xem cÃ³ pháº£i Ä‘ang tÃ¬m tráº­n hay khÃ´ng, vÃ  **#3** Ä‘á»ƒ cháº¥p nháº­n tráº­n Ä‘áº¥u.

Äi ngÆ°á»£c tá»« **#6** xuá»‘ng, cÃ¡i nÃ y Ä‘á»ƒ lock tÆ°á»›ng Ä‘ang chá»n, nhÆ°ng muá»‘n lock Ä‘Æ°á»£c thÃ¬ pháº£i pick tÆ°á»›ng trÆ°á»›c. Váº­y lÃ  pháº£i dÃ¹ng **#5** Ä‘á»ƒ chá»n ra má»™t tÆ°á»›ng. Cáº£ hai tháº±ng Ä‘á»u cÃ³ `id` lÃ  sá»‘ cáº§n tÃ¬m, vÃ  theo mÃ¬nh tÃ¬m hiá»ƒu Ä‘Æ°á»£c, thÃ¬ Ä‘Ã¢y lÃ  vá»‹ trÃ­ cá»§a báº¡n trong tráº­n.
> Trong Ä‘áº¥u tÃ¹y chá»n hoáº·c phÃ²ng táº­p, sá»‘ nÃ y máº·c Ä‘á»‹nh lÃ  **thá»© tá»± gia nháº­p cá»§a báº¡n** + **sá»‘ lÆ°á»£ng BOT** (nhÃ¢n váº­t mÃ¡y).

```json
> Ä‘oáº¡n JSON máº«u
actions: [[
    {actorCellId: 1, id: 2},
    {actorCellId: 2, id: 3},
    {actorCellId: 3, id: 1}
 ]],
localPlayerCellId: 3
[
```

Äá»ƒ cÃ³ Ä‘Æ°á»£c `id` má»™t cÃ¡ch tá»± Ä‘á»™ng, thÃ¬ ta láº¥y `localPlayerCellId` - thá»© tá»± chá»n tÆ°á»›ng cá»§a báº¡n (thÆ°á»ng gá»i lÃ  s1, s2, s3...) rá»“i tÃ¬m trong `actions` sáº½ cÃ³ `actorCellId` mang giÃ¡ trá»‹ tÆ°Æ¡ng tá»±, tá»« Ä‘Ã³ suy ra `id`. Váº­y trong Ä‘oáº¡n máº«u trÃªn thÃ¬ `id` sáº½ lÃ  1.

## THá»°C HIá»†N

> Náº¿u báº¡n bá» qua pháº§n NgÃ¢m cá»©u thÃ¬ nÃªn quay láº¡i má»¥c [TÃ¬m cá»•ng káº¿t ná»‘i Ä‘áº¿n LCU](#tÃ¬m-cá»•ng-káº¿t-ná»‘i-Ä‘áº¿n-lcu) á»Ÿ trÃªn Ä‘á»ƒ xem cÃ¡ch láº¥y **port** vÃ  **pass**.

### Truy cáº­p vÃ  láº¥y ID tÆ°á»›ng

Má»Ÿ trÃ¬nh duyá»‡t web vÃ  nháº­p dÃ²ng sau vÃ o thanh Ä‘á»‹a chá»‰ rá»“i nháº¥n enter:
```
https://127.0.0.1:PORT/lol-champions/v1/owned-champions-minimal
```
- Chá»— **PORT** thay báº±ng port cá»§a báº¡n.

Sau Ä‘Ã³, cÃ³ má»™t há»™p thoáº¡i yÃªu cáº§u Ä‘Äƒng nháº­p hiá»‡n ra:
<p align="center">
    <img src="./login.png">
</p>

Pháº§n tÃªn ngÆ°á»i dÃ¹ng cá»© Ä‘á»ƒ lÃ  **riot**, cÃ²n máº­t kháº©u thÃ¬ nháº­p Ä‘oáº¡n pass lÃºc nÃ£y vÃ o. Náº¿u Ä‘Äƒng nháº­p thÃ nh cÃ´ng, trÃ¬nh duyá»‡t sáº½ hiá»‡n ra má»™t Ä‘oáº¡n JSON dÃ i sÃ²ng sá»c nhÆ° sau:
```json
[{
    "active": true,
    "alias": "Annie",
    "banVoPath": "/lol-game-data/assets/v1/champion-ban-vo/1.ogg",
    ...
```

ÄÃ¢y chÃ­nh lÃ  dá»¯ liá»‡u vá» táº¥t cáº£ tÆ°á»›ng mÃ  báº¡n cÃ³ thá»ƒ chÆ¡i Ä‘Æ°á»£c (bao gá»“m tÆ°á»›ng Ä‘Ã£ mua vÃ  miá»…n phÃ­). HÃ£y má»Ÿ thanh tÃ¬m kiáº¿m trong trang (nháº¥n **Ctrl**+**F**) vÃ  nháº­p `"name":"tÃªn_tÆ°á»›ng`. Thay `tÃªn_tÆ°á»›ng` báº±ng tÆ°á»›ng báº¡n muá»‘n tÃ¬m, `yasuo` cháº³ng háº¡n.
```
..."id":157,"name":"Yasuo","ownership"...
```

Náº¿u tÃ¬m kiáº¿m trÃ¹ng khá»›p, ta sáº½ tháº¥y trÆ°á»›c Ä‘oáº¡n tÃ´ Ä‘áº­m sáº½ lÃ  ID cá»§a tÆ°á»›ng, ghi láº¡i ID cá»§a má»™t vÃ i tÆ°á»›ng mÃ  báº¡n muá»‘n chá»n.

### Viáº¿t code

Má»Ÿ console ngay táº¡i tab lÃºc nÃ£y Ä‘á»ƒ nháº­p code, náº¿u báº¡n sá»­ dá»¥ng **Chrome** hay **CocCoc** trÃªn Windows thÃ¬ cÃ³ thá»ƒ nháº¥n tá»• há»£p phÃ­m **Ctrl**+**Shift**+**J**.

Táº¡o hÃ m request Ä‘Æ¡n giáº£n vá»›i  `fetch`, nháº­p code sau vÃ o console vÃ  nháº¥n enter:
```js
var request = async (method, url, body = undefined) => {
    const data = await fetch(url, {
        method: method,
        body: body,
        headers: {'Content-type': 'application/json; charset=UTF-8'}
    }).then(res => res.text())
      .then(txt => JSON.parse(txt.length ? txt : '{}'));
    return data;
};
```
- CÃ³ thá»ƒ bá» qua tham sá»‘ `body` (cho phÆ°Æ¡ng thá»©c **GET**).
- DÃ¹ng vá»›i `await` Ä‘á»ƒ Ä‘á»“ng bá»™.

HÃ m kiá»ƒm tra cÃ³ pháº£i Ä‘ang chá» cháº¥p nháº­n tráº­n Ä‘áº¥u:
```js
> console
< Khi tÃ¬m tháº¥y tráº­n, thuá»™c tÃ­nh {state} sáº½ mang giÃ¡ trá»‹ lÃ  {InProgress}.
[
var isInProgress = async () => (await request(
    'GET', '/lol-matchmaking/v1/ready-check')).state === 'InProgress';
```

HÃ m cháº¥p nháº­n tráº­n Ä‘áº¥u:
```js
> console
[
var acceptMatch = async () => await request(
    'POST', '/lol-matchmaking/v1/ready-check/accept');
```

HÃ m láº¥y action ID:
```js
> console
< Tráº£ vá» -1 náº¿u khÃ´ng pháº£i Ä‘ang chá»n tÆ°á»›ng. DÃ¹ng {filter} Ä‘á»ƒ lá»c ra {id} cá»§a chÃ­nh mÃ¬nh.
[
var getActionId = async () => {
    var {localPlayerCellId, actions} =
        await request('GET', '/lol-champ-select/v1/session');
    if (!actions) return -1;
    return actions[0].filter(v =>
        v.actorCellId === localPlayerCellId)[0].id;
};
```

HÃ m `pick` vÃ  hÃ m `lock`:
```js
> console
[
var pick = async (id, championId) => Object.keys(await request(
    'PATCH', `/lol-champ-select/v1/session/actions/${id}`,
    JSON.stringify({championId}))).length === 0;

var lock = async (id) => await request(
    'POST', `/lol-champ-select/v1/session/actions/${id}/complete`);
```
- Tham sá»‘ `id` láº¥y tá»« hÃ m `getActionId`.
- Khi chá»n tÆ°á»›ng thÃ nh cÃ´ng thÃ¬ ta Ä‘Æ°á»£c Ä‘oáº¡n JSON rá»—ng.

VÃ  cuá»‘i cÃ¹ng lÃ  hÃ m auto cháº¥p nháº­n tráº­n dáº¥u vÃ  pick-lock:
```js
> console
< Khi khÃ³a tÆ°á»›ng xong sáº½ dá»«ng auto.
[
var start = (championIds = [157]) => {
    var inv = setInterval(async () => {
        var id;
        if (await isInProgress()) {
            await acceptMatch();
        } else if ((id = await getActionId()) > -1) {
            for (var i=0; i<championIds.length; i++)
                if (await pick(id, championIds[i])) break;
            await lock(id);
            clearInterval(inv);
        }
    }, 250);
};
```
- Tham sá»‘ `championIds` lÃ  máº£ng ID tÆ°á»›ng, phÃ²ng trÆ°á»ng há»£p cÃ³ ngÆ°á»i chá»n tÆ°á»›ng Ä‘Ã³ trÆ°á»›c báº¡n, máº·c Ä‘á»‹nh lÃ  **Yasuo**.
- DÃ¹ng `setInterval` Ä‘á»ƒ check liÃªn tá»¥c, vÃ¬ ta khÃ´ng cÃ³ event nÃ o cáº£.

### Test

Chá»‰ cáº§n gá»i hÃ m `start` vÃ  truyá»n vÃ o má»™t máº£ng ID cá»§a tÆ°á»›ng:
```js
> console
[
start([157, 10, 1]);
```
- **Yasuo**, **Kayle** vÃ  **Annie**, hÃ£y Ä‘áº£m báº£o ráº±ng báº¡n cÃ³ thá»ƒ chá»n Ä‘Æ°á»£c Ã­t nháº¥t 1 trong 3 tÆ°á»›ng nÃ y.
- Hoáº·c thay báº±ng ID cá»§a cÃ¡c tÆ°á»›ng khÃ¡c.

Váº­y lÃ  Ä‘Ã£ xong háº¿t má»i thá»©, hÃ£y táº¡o má»™t tráº­n **phÃ²ng táº­p** hoáº·c **Ä‘áº¥u thÆ°á»ng** rá»“i báº¯t Ä‘áº§u vÃ  **buÃ´ng chuá»™t**.

<p align='center'>
<img src='https://gamek.mediacdn.vn/2018/5/9/ys-15258553135441465937409.gif'>
</p>

## Bonus

Báº¡n cÃ³ thá»ƒ theo dÃµi vÃ  cáº­p nháº­t code táº¡i repo nÃ y
- [https://github.com/nomi-san/yasuo](https://github.com/nomi-san/yasuo)

CÅ©ng trong repo nÃ y, cÃ³ thÃªm vÃ i thá»© cÃ³ thá»ƒ giÃºp Ã­ch cho báº¡n
- **yasuoit** - viáº¿t báº±ng **AutoIt**, cÃ³ chá»©c nÄƒng tÆ°Æ¡ng tá»± nhÆ° trong bÃ i viáº¿t.
- **yasharp** - viáº¿t báº±ng **C#**, chá»©c nÄƒng tÆ°Æ¡ng tá»± luÃ´n, nhÆ°ng mÃ  tÆ°Æ¡ng tÃ¡c qua **khung chat** Ä‘áº¥y, sá»­ dá»¥ng websocket Ä‘á»ƒ báº¯t sá»± kiá»‡n tá»« LCU.

<p align='center'>
    <img src='./yasharp-demo.jpg'>
    <br>
    Demo gÃµ <strong>/?</strong> vÃ o khung chat.
</p>

Trong **node.js**:
- Gá»­i request (nÃªn dÃ¹ng **request-promise**), cÃ³ 2 cÃ¡ch:
    - Náº¡p credentials trá»±c tiáº¿p vÃ o uri:<br>`https://riot:PASS@127.0.0.1:PORT/...`
    - Hoáº·c náº¡p thÃ´ng qua header:<br>`{'Authorization': 'Basic ' + btoa('riot:' + PASS)}`
- Náº¿u báº¡n muá»‘n báº¯t sá»± kiá»‡n LCU, hÃ£y xem qua [gist nÃ y](https://gist.github.com/Pupix/eb662b1b784bb704a1390643738a8c15) (chá»— comment cá»§a mÃ¬nh ngáº¯n hÆ¡n).
    ```js
    > index.js
    const WebSocket = require('ws');
    // VÃ´ hiá»‡u hÃ³a xÃ¡c thá»±c TLS.
    process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = 0;

    // Káº¿t ná»‘i vÃ o websocket ngáº§m cá»§a LCU, protocol lÃ  WAMP.
    const ws = new WebSocket('wss://riot:PASS@127.0.0.1:PORT/', 'wamp');

    // ÄÄƒng kÃ½ topic OnJsonApiEvent.
    ws.on('open', () => {
        ws.send('[5, "OnJsonApiEvent"]');
    });

    // Nháº­n message chá»‰ khi League Client (UI) gá»­i request.
    ws.on('message', (msg) => {
        console.log(msg); // gá»“m JSON, uri vÃ  event name.
    });
    ```

NgoÃ i ra cÃ²n vÃ i thá»© khÃ¡c:
- [Mimic](https://github.com/molenzwiebel/Mimic) - má»™t app giÃºp Ä‘iá»u khiá»ƒn **League Client** qua LAN, dÃ¹ng **C#** Ä‘á»ƒ viáº¿t cá»•ng truyá»n táº£i dá»¯ liá»‡u báº±ng **websocket**, giao diá»‡n thÃ¬ viáº¿t báº±ng **Vuejs**.
- [Deceive](https://github.com/molenzwiebel/Deceive) - giÃºp báº¡n offline (áº©n Ä‘i) sau khi Ä‘Äƒng nháº­p.

## FAQ

### # Vá» viá»‡c pick-lock tÆ°á»›ng

#### Tá»‰ lá»‡ thÃ nh cÃ´ng lÃ  bao nhiÃªu?
> 100%, náº¿u máº¥t káº¿t ná»‘i thÃ¬ lÃ  0%.

#### CÃ³ bá»‹ khÃ³a tÃ i khoáº£n khÃ´ng?
> **KhÃ´ng**, Ä‘Ã¢y Ä‘Æ¡n thuáº§n chá»‰ lÃ  _"mÆ°á»£n tay mÆ°á»£n chÃ¢n"_ cá»§a client thÃ´i (do ta dÃ¹ng API má»™t cÃ¡ch há»£p phÃ¡p).

> NhÆ°ng trong tÆ°Æ¡ng lai khÃ¡c nhÃ©! Báº¡n cÃ³ nghe vá» má»™t sá»‘ tool modskin chá»©? KhÃ´ng gÃ¢y háº¡i ai, nhÆ°ng do bá»‹ láº¡m dá»¥ng quÃ¡ má»©c nÃªn bá»‹ **Garena** cho vÃ o danh sÃ¡ch Ä‘en (pháº§n má»m thá»© ba can thiá»‡p vÃ o game) vá»›i tá»™i danh mÃ  ai cÅ©ng cho lÃ  vÃ´ lÃ½ - "**cÆ°á»›p miáº¿ng cÆ¡n manh Ã¡o**". VÃ  tool pick-lock trong bÃ i nÃ y cÅ©ng cÃ³ thá»ƒ Ä‘i theo váº¿t xe Ä‘á»— cá»§a modskin.

#### Táº¡i sao má»™t sá»‘ tool á»Ÿ cuá»‘i bÃ i khÃ´ng hoáº¡t Ä‘á»™ng trÃªn Windows 7?
> Cháº¯c báº¡n dÃ¹ng Windows 7 quÃ¡ cÅ© rá»“i, thá»­ cÃ i thÃªm [cÃ¡i nÃ y](http://www.catalog.update.microsoft.com/search.aspx?q=kb3140245) vÃ  [cÃ¡i nÃ y ná»¯a](http://download.microsoft.com/download/0/6/5/0658B1A7-6D2E-474F-BC2C-D69E5B9E9A68/MicrosoftEasyFix51044.msi).

#### Äá»“ng Ä‘á»™i cÃ¹ng sá»­ dá»¥ng pick-lock nÃ y thÃ¬ sáº½ nhÆ° tháº¿ nÃ o?
> Do sá»­ dá»¥ng API thÃ´ng qua request Ä‘áº¿n LCU server nÃªn sáº½ phá»¥c thuá»™c vÃ o Ä‘Æ°á»ng truyá»n máº¡ng.

> Trong pháº§n hÆ°á»›ng dáº«n trÃªn, mÃ¬nh Ä‘áº·t Ä‘á»™ trá»… lÃ  250ms, báº¡n cÃ³ thá»ƒ thay Ä‘á»•i. Äá»‘i vá»›i 2 tool Ä‘Ã£ nÃ³i á»Ÿ trÃªn, thÃ¬ **yasharp** sáº½ cÃ³ Ä‘á»™ trá»… nhá» hÆ¡n **yasuoit** do sá»­ dá»¥ng callback (tá»« LCU websocket) thay vÃ¬ dÃ¹ng vÃ²ng láº·p Ä‘á»ƒ kiá»ƒm tra (xem mÃ£ nguá»“n sáº½ rÃµ).

### # Váº¥n Ä‘á» khÃ¡c

#### TÃ´i cÃ³ thá»ƒ lÃ m gÃ¬ sau khi Ä‘á»c bÃ i viáº¿t nÃ y?
> Náº¿u báº¡n thá»±c sá»± hiá»ƒu Ä‘Æ°á»£c áº©n Ã½ trong Ä‘Ã¢y thÃ¬ khÃ´ng cáº§n pháº£i xem cÃ¢u há»i nÃ y. ÄÆ¡n giáº£n lÃ  viáº¿t Ä‘Æ°á»£c "**tool**".

#### Garena khá»Ÿi Ä‘á»™ng LMHT nhÆ° tháº¿ nÃ o?
> Váº«n lÃ  truyá»n tham sá»‘ vÃ o **LeagueClient.exe**, thá»­ xem cÃ¡c tham sá»‘ cá»§a nÃ³ báº±ng lá»‡nh trong má»¥c [TÃ¬m cá»•ng káº¿t ná»‘i Ä‘áº¿n LCU](#tÃ¬m-cá»•ng-káº¿t-ná»‘i-Ä‘áº¿n-lcu). Báº¡n sáº½ cÃ³ tháº¥y má»™t Ä‘oáº¡n **token** cá»§a Garena sinh ra, háº¡n dÃ¹ng cá»§a nÃ³ lÃ  3p sau khi táº¯t League Client.

#### CÃ³ thá»ƒ custom pass vÃ  port cá»§a LCU khÃ´ng?
> KhÃ´ng thÃ nh váº¥n Ä‘á», thÃªm 2 tham sá»‘ nÃ y vÃ o khi thá»±c thi **LeagueClient** (Ä‘á»‘i vá»›i mÃ¡y chá»§ **Garena** thÃ¬ copy tham sá»‘ láº¥y Ä‘Æ°á»£c tá»« cÃ¢u há»i á»Ÿ trÃªn):<br>`--remoting-auth-token=abcdef123456fedcba654321 --app-port=1234`

#### LÃ m sao Ä‘á»ƒ cháº¡y nhiá»u League Client cÃ¹ng lÃºc?
> ThÃªm tham sá»‘ `--allow-multiple-clients` khi thá»±c thi **LeagueClient**.

#### TÃ´i cÃ³ thá»ƒ Ä‘Ã³ng háº¿t táº¥t cáº£ League Client cá»§a má»™t quÃ¡n net khÃ´ng?
> CÃ³ thá»ƒ, náº¿u báº¡n truy cáº­p Ä‘Æ°á»£c mÃ¡y chá»§ vÃ  tÃ¬m Ä‘Æ°á»£c IP cá»¥c bá»™ cá»§a cÃ¡c mÃ¡y tÃ­nh cÃ¹ng port cá»§a League Client Ä‘ang cháº¡y. Sau Ä‘Ã³ chá»‰ cáº§n má»™t thiáº¿t bá»‹ cÃ³ thá»ƒ truy cáº­p máº¡ng cá»§a quÃ¡n net vÃ  gá»­i POST request:<br> `https://riot:PASS@LAN_IP:PORT/process-control/v1/process/quit`

#### Giá»‘ng nhÆ° cÃ¢u há»i trÃªn, nhÆ°ng má»¥c Ä‘Ã­ch dÃ nh cho quáº£n lÃ½ quÃ¡n net?
> ÄÆ°á»£c, báº¡n muá»‘n xem thÃ´ng tin cá»§a ngÆ°á»i chÆ¡i Æ°?
